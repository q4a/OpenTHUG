<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OpenTHUG: Файл C:/git/thug/src/gfx/NGC/NX/grass.cpp</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">OpenTHUG
   &#160;<span id="projectnumber">0.1.0</span>
   </div>
   <div id="projectbrief">OpenTHUG: let&#39;s port THUG on Linux</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Создано системой Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Поиск');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Поиск');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d3/d02/_n_g_c_2_n_x_2grass_8cpp.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Функции</a>  </div>
  <div class="headertitle">
<div class="title">Файл grass.cpp</div>  </div>
</div><!--header-->
<div class="contents">

<p><a href="../../d3/d02/_n_g_c_2_n_x_2grass_8cpp_source.html">См. исходные тексты.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Функции</h2></td></tr>
<tr class="memitem:a754409a657f3dbc6e6ecc3296dd618c4"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d02/_n_g_c_2_n_x_2grass_8cpp.html#a754409a657f3dbc6e6ecc3296dd618c4">AddGrass</a> (<a class="el" href="../../de/dc7/class_nx_1_1_c_ngc_geom.html">Nx::CNgcGeom</a> *p_geom, <a class="el" href="../../df/d4e/struct_nx_ngc_1_1s_mesh.html">NxNgc::sMesh</a> *p_mesh)</td></tr>
<tr class="separator:a754409a657f3dbc6e6ecc3296dd618c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Функции</h2>
<a id="a754409a657f3dbc6e6ecc3296dd618c4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a754409a657f3dbc6e6ecc3296dd618c4">&#9670;&nbsp;</a></span>AddGrass()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool AddGrass </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../de/dc7/class_nx_1_1_c_ngc_geom.html">Nx::CNgcGeom</a> *&#160;</td>
          <td class="paramname"><em>p_geom</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../df/d4e/struct_nx_ngc_1_1s_mesh.html">NxNgc::sMesh</a> *&#160;</td>
          <td class="paramname"><em>p_mesh</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<ul>
<li>Zockler et al's technique worked with streamlines, and used dot(V,T) instead of the simpler dot(H,T) *&zwj;/ </li>
</ul>

<p class="definition">См. определение в файле <a class="el" href="../../d3/d02/_n_g_c_2_n_x_2grass_8cpp_source.html">grass.cpp</a> строка <a class="el" href="../../d3/d02/_n_g_c_2_n_x_2grass_8cpp_source.html#l01292">1292</a></p>
<div class="fragment"><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;{</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;<span class="preprocessor">#if 0</span></div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;    <span class="keywordtype">bool</span> add_grass = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;    </div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;    <span class="keywordflow">if</span>( p_mesh-&gt;mp_material &amp;&amp; p_mesh-&gt;mp_material-&gt;m_grassify )</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;    {</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;        add_grass = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;    }</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;    {</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;    }</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160; </div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;    <span class="comment">// At this stage we know we want to add grass.</span></div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;    Dbg_Assert( p_mesh-&gt;mp_material-&gt;m_grass_layers &gt; 0 );</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;<span class="comment">//  float height_per_layer = p_mesh-&gt;mp_material-&gt;m_grass_height / p_mesh-&gt;mp_material-&gt;m_grass_layers;</span></div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;    </div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;    <span class="keywordflow">for</span>( <span class="keywordtype">int</span> layer = 0; layer &lt; p_mesh-&gt;mp_material-&gt;m_grass_layers; ++layer )</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;    {</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;        <a class="code" href="../../d2/d0a/class_mem_1_1_manager.html#a3aefd91781b7f41d35e6df6a32d379d0">Mem::Manager::sHandle</a>().<a class="code" href="../../d2/d0a/class_mem_1_1_manager.html#aaf8e36abc36eecabe46bf2582035192a">PushContext</a>( <a class="code" href="../../d2/d0a/class_mem_1_1_manager.html#a3aefd91781b7f41d35e6df6a32d379d0">Mem::Manager::sHandle</a>().BottomUpHeap());</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;        <a class="code" href="../../df/d4e/struct_nx_ngc_1_1s_mesh.html">NxNgc::sMesh</a> *p_grass_mesh = p_mesh-&gt;<a class="code" href="../../df/d4e/struct_nx_ngc_1_1s_mesh.html#abc35b06bcaf1b42e40b7635ac2b1eba2">Clone</a>( <span class="keyword">false</span> );</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;        <a class="code" href="../../d2/d0a/class_mem_1_1_manager.html#a3aefd91781b7f41d35e6df6a32d379d0">Mem::Manager::sHandle</a>().<a class="code" href="../../d2/d0a/class_mem_1_1_manager.html#a7c4cba14870f002aee0243e16114f443">PopContext</a>();</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160; </div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;        <span class="comment">// No longer any shadow cast on the base mesh.</span></div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;<span class="comment">//      p_mesh-&gt;m_flags |= NxNgc::sMesh::MESH_FLAG_NO_SKATER_SHADOW;</span></div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;        </div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;        <span class="keywordflow">if</span>( layer != 2 )</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;            p_grass_mesh-&gt;<a class="code" href="../../df/d4e/struct_nx_ngc_1_1s_mesh.html#a172e87a3116b5e5edde4b0f0267ec91f">m_flags</a> |= <a class="code" href="../../df/d4e/struct_nx_ngc_1_1s_mesh.html#a2a7a964ed79cc1c9a51c7b44ca072b10aeb9ebcbfd81197c6b43f0d88b771c8fe">NxNgc::sMesh::MESH_FLAG_NO_SKATER_SHADOW</a>;</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;        </div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;        <span class="comment">// Now point the mesh to a different material, first build the material checksum from the name of the parent</span></div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;        <span class="comment">// material (Grass) and the name of the sub material (Grass_LayerX)...</span></div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;        <span class="keywordtype">char</span> material_name[64];</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;        <a class="code" href="../../da/d37/namespace_dbg.html#ab406a8cc16de5046c7d9fd09c9de5e22">sprintf</a>( material_name, <span class="stringliteral">&quot;Grass-Grass_Layer%d&quot;</span>, layer );</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;        <a class="code" href="../../d8/de2/_defines_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> material_checksum    = <a class="code" href="../../d3/d9b/namespace_crc.html#a60ea952dd05dcbab6d54f8f922f35872">Crc::GenerateCRCCaseSensitive</a>( material_name, strlen( material_name ));</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160; </div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;        <span class="comment">// ...then use the checksum to lookup the material.</span></div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;        p_grass_mesh-&gt;mp_material   = p_geom-&gt;<a class="code" href="../../de/dc7/class_nx_1_1_c_ngc_geom.html#a99394aef097a106ce4afb7bea76e22ca">mp_scene</a>-&gt;<a class="code" href="../../d5/da4/class_nx_1_1_c_ngc_scene.html#aa5f47c07e889152b428639515cb2c98c">GetEngineScene</a>()-&gt;GetMaterial( material_checksum );</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160; </div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;        <span class="comment">// We need also to override the mesh pixel shader, which may have been setup for a multipass material.</span></div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;<span class="comment">//      NxNgc::GetPixelShader( p_grass_mesh-&gt;mp_material, &amp;p_grass_mesh-&gt;m_pixel_shader, &amp;p_grass_mesh-&gt;m_pixel_shader_no_mcm );</span></div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;        </div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;        <span class="comment">// Add transparent flag to the material.</span></div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;        p_grass_mesh-&gt;mp_material-&gt;Flags[0]     |= 0x40;</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160; </div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;        <span class="comment">// Set the draw order to ensure meshes are drawn from the bottom up.</span></div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;        p_grass_mesh-&gt;mp_material-&gt;m_sorted      = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;        p_grass_mesh-&gt;mp_material-&gt;m_draw_order  = layer * 0.1f;</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;        </div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;        <span class="comment">// Go through and move all the vertices up a little, and calculate new texture coordinates based on the x-z space of the vertex positions.</span></div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;<span class="comment">//      char *p_byte_dest;</span></div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;<span class="comment">//      p_grass_mesh-&gt;mp_vertex_buffer[0]-&gt;Lock( 0, 0, &amp;p_byte_dest, 0 );</span></div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;<span class="comment">//      for( uint32 vert = 0; vert &lt; p_grass_mesh-&gt;m_num_vertices; ++vert )</span></div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;<span class="comment">//      {</span></div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;<span class="comment">//          D3DXVECTOR3 *p_pos = (D3DXVECTOR3*)( p_byte_dest + ( vert * p_grass_mesh-&gt;m_vertex_stride ));</span></div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;<span class="comment">//          p_pos-&gt;y += ( height_per_layer * ( layer + 1 ));</span></div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;<span class="comment">//          float u         = fabsf( p_pos-&gt;x ) / 48.0f;</span></div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;<span class="comment">//          float v         = fabsf( p_pos-&gt;z ) / 48.0f;</span></div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;<span class="comment">//          float *p_tex    = (float*)( p_byte_dest + p_grass_mesh-&gt;m_uv0_offset + ( vert * p_grass_mesh-&gt;m_vertex_stride ));</span></div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;<span class="comment">//          p_tex[0]        = u;        </span></div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;<span class="comment">//          p_tex[1]        = v;</span></div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;<span class="comment">//      }</span></div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160; </div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;        p_geom-&gt;<a class="code" href="../../de/dc7/class_nx_1_1_c_ngc_geom.html#a9fcf285f56eb729b6a30d7ba40919957">AddMesh</a>( p_grass_mesh );</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;    }</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;    </div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;<span class="comment">/*  </span></div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;<span class="comment">    </span></div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;<span class="comment">    if( p_mesh-&gt;mp_material &amp;&amp; p_mesh-&gt;mp_material-&gt;pTex[0] )</span></div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;<span class="comment">    {</span></div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;<span class="comment">        if( p_mesh-&gt;mp_material-&gt;Passes == 1 )</span></div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;<span class="comment">        {</span></div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;<span class="comment">            if( p_mesh-&gt;mp_material-&gt;pTex[0]-&gt;Checksum == 0x8d9b6a64 )</span></div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;<span class="comment">                add_grass = true;</span></div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;<span class="comment">    if( !add_grass )</span></div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;<span class="comment">        return false;</span></div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;<span class="comment">    createGrassMats();</span></div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;<span class="comment">    // At this stage we know we want to add grass.</span></div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;<span class="comment">    for( int layer = 0; layer &lt; 6; ++layer )</span></div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;<span class="comment">    {</span></div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;<span class="comment">        Mem::Manager::sHandle().PushContext( Mem::Manager::sHandle().BottomUpHeap());</span></div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;<span class="comment">        NxNgc::sMesh *p_grass_mesh = p_mesh-&gt;Clone( false );</span></div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;<span class="comment">        Mem::Manager::sHandle().PopContext();</span></div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;<span class="comment">        // No longer any shadow cast on the base mesh.</span></div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;<span class="comment">//      p_mesh-&gt;m_flags |= NxNgc::sMesh::MESH_FLAG_NO_SKATER_SHADOW;</span></div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;<span class="comment">        </span></div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;<span class="comment">        if( layer != 2 )</span></div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;<span class="comment">            p_grass_mesh-&gt;m_flags |= NxNgc::sMesh::MESH_FLAG_NO_SKATER_SHADOW;</span></div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;<span class="comment">        </span></div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;<span class="comment">        // Now point the mesh to a different material.</span></div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;<span class="comment">        p_grass_mesh-&gt;mp_material = p_grass_mats[layer];</span></div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;<span class="comment">        // Go through and move all the vertices up a little, and calculate new texture coordinates based on the x-z space of the vertex positions.</span></div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;<span class="comment">        BYTE *p_byte_dest;</span></div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;<span class="comment">        p_grass_mesh-&gt;mp_vertex_buffer[0]-&gt;Lock( 0, 0, &amp;p_byte_dest, 0 );</span></div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;<span class="comment">        for( uint32 vert = 0; vert &lt; p_grass_mesh-&gt;m_num_vertices; ++vert )</span></div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;<span class="comment">        {</span></div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;<span class="comment">            D3DXVECTOR3 *p_pos = (D3DXVECTOR3*)( p_byte_dest + ( vert * p_grass_mesh-&gt;m_vertex_stride ));</span></div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;<span class="comment">            p_pos-&gt;y += ( 1.0f * ( layer + 1 ));</span></div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;<span class="comment">            float u         = fabsf( p_pos-&gt;x ) / 48.0f;</span></div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;<span class="comment">            float v         = fabsf( p_pos-&gt;z ) / 48.0f;</span></div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;<span class="comment">            float *p_tex    = (float*)( p_byte_dest + p_grass_mesh-&gt;m_uv0_offset + ( vert * p_grass_mesh-&gt;m_vertex_stride ));</span></div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;<span class="comment">            p_tex[0]        = u;        </span></div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;<span class="comment">            p_tex[1]        = v;</span></div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;<span class="comment">        p_geom-&gt;AddMesh( p_grass_mesh );</span></div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">Перекрестные ссылки <a class="el" href="../../d1/d15/_n_g_c_2p___nx_geom_8cpp_source.html#l00112">Nx::CNgcGeom::AddMesh()</a>, <a class="el" href="../../d0/d65/_n_g_c_2_n_x_2mesh_8cpp_source.html#l00521">NxNgc::sMesh::Clone()</a>, <a class="el" href="../../d8/dd1/crc_8cpp_source.html#l00171">Crc::GenerateCRCCaseSensitive()</a>, <a class="el" href="../../db/deb/_n_g_c_2p__nxscene_8h_source.html#l00022">Nx::CNgcScene::GetEngineScene()</a>, <a class="el" href="../../d6/d43/_n_g_c_2_n_x_2mesh_8h_source.html#l00104">NxNgc::sMesh::m_flags</a>, <a class="el" href="../../d6/d43/_n_g_c_2_n_x_2mesh_8h_source.html#l00048">NxNgc::sMesh::MESH_FLAG_NO_SKATER_SHADOW</a>, <a class="el" href="../../d0/d8f/_n_g_c_2p___nx_geom_8h_source.html#l00102">Nx::CNgcGeom::mp_scene</a>, <a class="el" href="../../df/dda/win32functions_8cpp_source.html#l00075">Mem::Manager::PopContext()</a>, <a class="el" href="../../df/dda/win32functions_8cpp_source.html#l00071">Mem::Manager::PushContext()</a>, <a class="el" href="../../d3/d76/memman_8h_source.html#l00340">Mem::Manager::sHandle()</a> и <a class="el" href="../../da/d37/namespace_dbg.html#ab406a8cc16de5046c7d9fd09c9de5e22">Dbg::sprintf()</a>.</p>

<p class="reference">Используется в <a class="el" href="../../d7/d87/_x_box_2p__nxsector_8cpp_source.html#l00282">Nx::CXboxSector::LoadFromFile()</a> и <a class="el" href="../../d7/d87/_x_box_2p__nxsector_8cpp_source.html#l00036">Nx::CXboxSector::LoadFromMemory()</a>.</p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="../../closed.png" alt="+"/> Граф вызовов:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="../../d3/d02/_n_g_c_2_n_x_2grass_8cpp_a754409a657f3dbc6e6ecc3296dd618c4_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="../../closed.png" alt="+"/> Граф вызова функции:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d3/d02/_n_g_c_2_n_x_2grass_8cpp_a754409a657f3dbc6e6ecc3296dd618c4_icgraph.svg" width="347" height="104"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="a_defines_8h_html_a1134b580f8da4de94ca6b1de4d37975e"><div class="ttname"><a href="../../d8/de2/_defines_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a></div><div class="ttdeci">unsigned long uint32</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/de2/_defines_8h_source.html#l00147">Defines.h:147</a></div></div>
<div class="ttc" id="astruct_nx_ngc_1_1s_mesh_html"><div class="ttname"><a href="../../df/d4e/struct_nx_ngc_1_1s_mesh.html">NxNgc::sMesh</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d43/_n_g_c_2_n_x_2mesh_8h_source.html#l00036">mesh.h:36</a></div></div>
<div class="ttc" id="astruct_nx_ngc_1_1s_mesh_html_a2a7a964ed79cc1c9a51c7b44ca072b10aeb9ebcbfd81197c6b43f0d88b771c8fe"><div class="ttname"><a href="../../df/d4e/struct_nx_ngc_1_1s_mesh.html#a2a7a964ed79cc1c9a51c7b44ca072b10aeb9ebcbfd81197c6b43f0d88b771c8fe">NxNgc::sMesh::MESH_FLAG_NO_SKATER_SHADOW</a></div><div class="ttdeci">@ MESH_FLAG_NO_SKATER_SHADOW</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d43/_n_g_c_2_n_x_2mesh_8h_source.html#l00048">mesh.h:48</a></div></div>
<div class="ttc" id="astruct_nx_ngc_1_1s_mesh_html_a172e87a3116b5e5edde4b0f0267ec91f"><div class="ttname"><a href="../../df/d4e/struct_nx_ngc_1_1s_mesh.html#a172e87a3116b5e5edde4b0f0267ec91f">NxNgc::sMesh::m_flags</a></div><div class="ttdeci">uint16 m_flags</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d43/_n_g_c_2_n_x_2mesh_8h_source.html#l00104">mesh.h:104</a></div></div>
<div class="ttc" id="astruct_nx_ngc_1_1s_mesh_html_abc35b06bcaf1b42e40b7635ac2b1eba2"><div class="ttname"><a href="../../df/d4e/struct_nx_ngc_1_1s_mesh.html#abc35b06bcaf1b42e40b7635ac2b1eba2">NxNgc::sMesh::Clone</a></div><div class="ttdeci">sMesh * Clone(bool instance=false)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d65/_n_g_c_2_n_x_2mesh_8cpp_source.html#l00521">mesh.cpp:521</a></div></div>
<div class="ttc" id="aclass_mem_1_1_manager_html_a3aefd91781b7f41d35e6df6a32d379d0"><div class="ttname"><a href="../../d2/d0a/class_mem_1_1_manager.html#a3aefd91781b7f41d35e6df6a32d379d0">Mem::Manager::sHandle</a></div><div class="ttdeci">static Manager &amp; sHandle(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d76/memman_8h_source.html#l00340">memman.h:340</a></div></div>
<div class="ttc" id="aclass_nx_1_1_c_ngc_geom_html_a99394aef097a106ce4afb7bea76e22ca"><div class="ttname"><a href="../../de/dc7/class_nx_1_1_c_ngc_geom.html#a99394aef097a106ce4afb7bea76e22ca">Nx::CNgcGeom::mp_scene</a></div><div class="ttdeci">CNgcScene * mp_scene</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d8f/_n_g_c_2p___nx_geom_8h_source.html#l00102">p_NxGeom.h:102</a></div></div>
<div class="ttc" id="aclass_mem_1_1_manager_html_aaf8e36abc36eecabe46bf2582035192a"><div class="ttname"><a href="../../d2/d0a/class_mem_1_1_manager.html#aaf8e36abc36eecabe46bf2582035192a">Mem::Manager::PushContext</a></div><div class="ttdeci">void PushContext(Allocator *alloc)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dda/win32functions_8cpp_source.html#l00071">win32functions.cpp:71</a></div></div>
<div class="ttc" id="aclass_nx_1_1_c_ngc_scene_html_aa5f47c07e889152b428639515cb2c98c"><div class="ttname"><a href="../../d5/da4/class_nx_1_1_c_ngc_scene.html#aa5f47c07e889152b428639515cb2c98c">Nx::CNgcScene::GetEngineScene</a></div><div class="ttdeci">NxNgc::sScene * GetEngineScene() const</div><div class="ttdef"><b>Definition:</b> <a href="../../db/deb/_n_g_c_2p__nxscene_8h_source.html#l00022">p_nxscene.h:22</a></div></div>
<div class="ttc" id="anamespace_crc_html_a60ea952dd05dcbab6d54f8f922f35872"><div class="ttname"><a href="../../d3/d9b/namespace_crc.html#a60ea952dd05dcbab6d54f8f922f35872">Crc::GenerateCRCCaseSensitive</a></div><div class="ttdeci">uint32 GenerateCRCCaseSensitive(const char *stream, int size)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd1/crc_8cpp_source.html#l00171">crc.cpp:171</a></div></div>
<div class="ttc" id="aclass_mem_1_1_manager_html_a7c4cba14870f002aee0243e16114f443"><div class="ttname"><a href="../../d2/d0a/class_mem_1_1_manager.html#a7c4cba14870f002aee0243e16114f443">Mem::Manager::PopContext</a></div><div class="ttdeci">void PopContext(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dda/win32functions_8cpp_source.html#l00075">win32functions.cpp:75</a></div></div>
<div class="ttc" id="anamespace_dbg_html_ab406a8cc16de5046c7d9fd09c9de5e22"><div class="ttname"><a href="../../da/d37/namespace_dbg.html#ab406a8cc16de5046c7d9fd09c9de5e22">Dbg::sprintf</a></div><div class="ttdeci">sprintf(tmp1, &quot;FILE:      %s(%d) &quot;, file, line)</div></div>
<div class="ttc" id="aclass_nx_1_1_c_ngc_geom_html_a9fcf285f56eb729b6a30d7ba40919957"><div class="ttname"><a href="../../de/dc7/class_nx_1_1_c_ngc_geom.html#a9fcf285f56eb729b6a30d7ba40919957">Nx::CNgcGeom::AddMesh</a></div><div class="ttdeci">void AddMesh(NxNgc::sMesh *)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d15/_n_g_c_2p___nx_geom_8cpp_source.html#l00112">p_NxGeom.cpp:112</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="../../dir_c86603f79b902ad390ffc2674fbc4470.html">gfx</a></li><li class="navelem"><a class="el" href="../../dir_fc598ce00690b1053355ea44bbe38731.html">NGC</a></li><li class="navelem"><a class="el" href="../../dir_73de6e80b2aaf5bdccd3aa1409a233c3.html">NX</a></li><li class="navelem"><a class="el" href="../../d3/d02/_n_g_c_2_n_x_2grass_8cpp.html">grass.cpp</a></li>
    <li class="footer">Документация по OpenTHUG. Последние изменения: Вс 26 Апр 2020 03:47:43. Создано системой
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
